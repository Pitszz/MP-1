import pytest
from game import Game, DisplayManager, Block, Level


# The methods with no return or yielded values are NOT unit tested.

# LEVEL TEST


def test_load_level():
    # Takes a FILENAME -> returns a DICT
    
    # TEST CASE 1
    file_name = "level1.in"
    game = Game(file_name)
    level_data = game.level_data

    grid1 = [[block.sprite for block in row] for row in level_data.grid]

    assert grid1 == [
    ["ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±"],
    ["ğŸ§±", "ğŸª¹", "ğŸª¹", "ğŸŸ©", "ğŸŸ©", "ğŸ¥š", "ğŸ¥š", "ğŸ§±"],
    ["ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ³", "ğŸ§±"],
    ["ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±"]
    ]
    assert level_data.max_moves == 5
    assert level_data.rows, level_data.cols == (4, 8)

    # TEST CASE 2
    file_name_2 = "level9.in"
    game_2 = Game(file_name_2)
    level_data_2 = game_2.level_data

    grid2 = [[block.sprite for block in row] for row in level_data_2.grid]

    assert grid2 == [
    ["ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±"],
    ["ğŸ§±", "ğŸ¥š", "ğŸ¥š", "ğŸ¥š", "ğŸ§±", "ğŸ³", "ğŸŸ©", "ğŸŸ©", "ğŸ§±"],
    ["ğŸ§±", "ğŸŸ©", "ğŸ§±", "ğŸ¥š", "ğŸ§±", "ğŸŸ©", "ğŸ§±", "ğŸ§±", "ğŸ§±"],
    ["ğŸ§±", "ğŸ¥š", "ğŸ¥š", "ğŸŸ©", "ğŸª¹", "ğŸª¹", "ğŸª¹", "ğŸŸ©", "ğŸ§±"],
    ["ğŸ§±", "ğŸŸ©", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸª¹", "ğŸ§±"],
    ["ğŸ§±", "ğŸŸ©", "ğŸ³", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸª¹", "ğŸ§±"],
    ["ğŸ§±", "ğŸŸ©", "ğŸ³", "ğŸŸ©", "ğŸ§±", "ğŸª¹", "ğŸ³", "ğŸŸ©", "ğŸ§±"],
    ["ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±", "ğŸŸ©", "ğŸ³", "ğŸŸ©", "ğŸ§±"],
    ["ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±"]
    ]
    assert level_data_2.max_moves == 60
    assert level_data_2.rows, level_data_2.cols == (9, 9)


    # TEST CASE 3
    file_name_3 = "level4.in"
    game_3 = Game(file_name_3)
    level_data_3 = game_3.level_data

    grid3 = [[block.sprite for block in row] for row in level_data_3.grid]

    assert grid3 == [
    ["ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±"],
    ["ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸª¹", "ğŸŸ©", "ğŸŸ©", "ğŸ³", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±"],
    ["ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸ¥š", "ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±", "ğŸ§±", "ğŸª¹", "ğŸŸ©", "ğŸ§±"],
    ["ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±"],
    ["ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±"],
    ["ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±", "ğŸ§±", "ğŸ³", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±"],
    ["ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±", "ğŸª¹", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±", "ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸ§±"],
    ["ğŸ§±", "ğŸ¥š", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸª¹", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±"],
    ["ğŸ§±", "ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ¥š", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±"],
    ["ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±"],
    ["ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±", "ğŸ³", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±"],
    ["ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±"],
    ["ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±", "ğŸŸ©", "ğŸ§±"],
    ["ğŸ§±", "ğŸ§±", "ğŸ³", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±", "ğŸŸ©", "ğŸ§±"],
    ["ğŸ§±", "ğŸ¥š", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±", "ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±", "ğŸŸ©", "ğŸ§±"],
    ["ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸª¹", "ğŸŸ©", "ğŸŸ©", "ğŸ³", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸ§±", "ğŸ§±", "ğŸ¥š", "ğŸ§±"],
    ["ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±"]
    ]
    assert level_data_3.max_moves == 15
    assert level_data_3.rows, level_data_3.cols == (19, 19)


    # TEST CASE 4
    file_name_4 = "levelcl.in"
    game_4 = Game(file_name_4)
    level_data_4 = game_4.level_data

    grid4 = [[block.sprite for block in row] for row in level_data_4.grid]

    assert grid4 == [
    ["ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±"],
    ["ğŸ§±", "ğŸ³", "ğŸ¥š", "ğŸ¥š", "ğŸ¥š", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±"],
    ["ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±", "ğŸŸ©", "ğŸ§±"],
    [" ", "ğŸ§±", "ğŸ§±", "ğŸ§±", " ", " ", " ", " ", "ğŸŸ©", "ğŸ§±", "ğŸŸ©", " "],
    ["ğŸ§±", "ğŸª¹", "ğŸŸ©", "ğŸŸ©", "ğŸ¥š", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±"],
    [" ", "ğŸ§±", "ğŸ§±", "ğŸŸ©", " ", " ", " ", " ", "ğŸª¹", "ğŸŸ©", "ğŸŸ©", " "], 
    ["ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸ§±"],
    ["ğŸ§±", "ğŸª¹", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸŸ©", "ğŸª¹", "ğŸ§±"],
    ["ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±", "ğŸ§±"],
    ]
    assert level_data_4.max_moves == 15
    assert level_data_4.rows, level_data_3.cols == (9, 12)

    # Level not in levels Folder (System Exits)
    file_name_x = "levelmissing.in"
    file_name_y = "levelhaha.in"
    file_name_z = "leveltest.in"

    with pytest.raises(SystemExit):
        # automatically goes to _load_level() after initialization
        assert Game(file_name_x)
        assert Game(file_name_y)
        assert Game(file_name_z)